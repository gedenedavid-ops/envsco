---
import '@fontsource/inter/latin-400.css';
import '@fontsource/inter/latin-500.css';
import 'leaflet/dist/leaflet.css';

import Footer from '../components/layout/Footer.astro';
import Header from '../components/layout/Header.astro';

interface Props {
  description: string;
  title: string;
}

const { description, title } = Astro.props;
---

<!DOCTYPE html>
<html lang="fr" x-data :class="{ dark: $store.theme.isDark }">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="theme-color" content="#3b82f6" />
    <meta name="color-scheme" content="light dark" />

    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <!-- Prevent flash -->
    <script>
      const saved = localStorage.getItem('theme');
      if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    </script>

    <!-- Alpine -->
    <script>
      import Alpine from 'alpinejs';
      import collapse from '@alpinejs/collapse';

      Alpine.plugin(collapse);

      Alpine.store('theme', {
        isDark: false,

        init() {
          const saved = localStorage.getItem('theme');
          this.isDark = saved
            ? saved === 'dark'
            : window.matchMedia('(prefers-color-scheme: dark)').matches;
        },

        toggle() {
          this.isDark = !this.isDark;
          localStorage.setItem('theme', this.isDark ? 'dark' : 'light');
        },
      });

      window.Alpine = Alpine;
      Alpine.start();
    </script>

    <style is:global>
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>

  <body
    x-cloak
    class="bg-gray-50 text-gray-900 dark:bg-gray-950 dark:text-gray-200 antialiased transition-colors duration-500"
  >
    <Header />

    <main class="min-h-[70vh]">
      <slot />
    </main>

    <Footer />
  </body>
</html>
